[supervisord]
nodaemon=true
logfile=/app/storage/logs/supervisord.log
pidfile=/tmp/supervisord.pid; === PROGRAM 1: PHP-FPM (The Web Service) ===
[program:fpm]
directory=/app; Run php-fpm in the foreground (--nodaemonize)
command=/usr/local/sbin/php-fpm --nodaemonize
user=www-data; Recommended: Run FPM as www-data for security
autostart=true
autorestart=true
startsecs=0               ; Start immediately
priority=5; Lower priority so other programs start after FPM is stable
stderr_logfile=/app/storage/logs/fpm.err.log
stdout_logfile=/app/storage/logs/fpm.out.log; === PROGRAM 2: QUEUE WORKER ===
[program:queue]
directory=/app
command=php artisan queue:work --sleep=3 --tries=3; IMPORTANT: Use www-data if FPM uses it, or root if the queue needs high permissions
user=root
autostart=true
autorestart=true
stderr_logfile=/app/storage/logs/queue.err.log
stdout_logfile=/app/storage/logs/queue.out.log; === PROGRAM 3: CRON SCHEDULER ===
[program:cron]
directory=/app
command=/usr/local/bin/supercronic /app/docker/php/cron/schedule.cron
autostart=true
autorestart=true
stderr_logfile=/app/storage/logs/cron.err.log
stdout_logfile=/app/storage/logs/cron.out.log