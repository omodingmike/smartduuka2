# --- START: HTTP Block for Internal Communication ---
server {
    listen 80;

    # Accept requests using the public domain or the internal Docker service name.
    # This is crucial for internal communication via 'http://nginx'.
    server_name  nginx;

    # --- Nginx Root & Index ---
    # root  /var/www/api2/public;
    index index.php            index.html;

    # --- Location blocks (same successful routing logic as 443) ---
    location / {
        try_files $uri $uri/ @php;
    }

    location @php {
        # Tell PHP-FPM the entry file is /app/public/index.php inside the api2 container.
        fastcgi_param SCRIPT_FILENAME /app/public/index.php;

        include      fastcgi_params;
        fastcgi_pass api2:9000;
    }

    location ~ \.php$ {
        return 404;
    }

    location ~ /\. {
        deny all;
    }
}
# --- END: HTTP Block for Internal Communication ---

server {
    listen              443                            ssl        http2;
    server_name         djapi.eruditesuganda.com;
    ssl_certificate     /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/private_key.key;
    # root /var/www/api2/public;
    index               index.php                      index.html;
    location / {
        try_files $uri $uri/ @php;
    }
    location @php {
        fastcgi_param SCRIPT_FILENAME /app/public/index.php;
        include       fastcgi_params;
        fastcgi_pass  api2:9000;
    }
    location ~ \.php$ {
        return 404;
    }
    location ~ /\. {
        deny all;
    }
}